{"version":3,"file":"nUErmb8O.js","sources":["../src/components/layers/textLayer.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ref, shallowRef, onMounted, nextTick, onBeforeUnmount } from \"vue\";\r\nimport { TextLayer, type PDFPageProxy } from \"pdfjs-dist\";\r\nimport type { pdfPageInfo } from \"../../types/pdf\";\r\n\r\nconst props = defineProps<{\r\n  page: PDFPageProxy;\r\n  pageInfo: pdfPageInfo;\r\n}>();\r\n\r\nconst _textLayer = ref<HTMLElement>();\r\nconst layer = shallowRef<TextLayer>();\r\nconst endContent = ref<HTMLElement>();\r\n\r\nconst renderTextContent = async () => {\r\n  if (!!_textLayer.value) {\r\n    if (layer.value) {\r\n      layer.value.cancel();\r\n    }\r\n    const { viewport } = props.pageInfo;\r\n    const { rotation, scale } = viewport;\r\n    const textContent = await props.page.streamTextContent({\r\n      includeMarkedContent: true,\r\n      disableNormalization: true,\r\n    });\r\n    layer.value = new TextLayer({\r\n      textContentSource: textContent,\r\n      container: _textLayer.value,\r\n      viewport,\r\n    });\r\n    let rat = viewport.width / viewport.height;\r\n    let r = \"\";\r\n\r\n    if (Math.abs(rotation) == 90) {\r\n      r += `translateY(${100 / rat}%)`;\r\n    }\r\n\r\n    if (Math.abs(rotation) == 180) {\r\n      r += `translate(100%, 100%)`;\r\n    }\r\n\r\n    if (Math.abs(rotation) == 270) {\r\n      r += `translateX(${100 * rat}%)`;\r\n    }\r\n\r\n    r += `rotate(${rotation}deg)`;\r\n    let s: CSSStyleDeclaration = _textLayer.value.style;\r\n    s.setProperty(\"--scale-factor\", `${scale}`);\r\n    [\r\n      \"webkitTransform\",\r\n      \"mozTransform\",\r\n      \"msTransform\",\r\n      \"oTransform\",\r\n      \"transform\",\r\n    ].forEach((e) => {\r\n      if (s.hasOwnProperty(e)) {\r\n        Object.assign(s, { [e]: r });\r\n      }\r\n    });\r\n    await layer.value.render();\r\n\r\n    endContent.value = document.createElement(\"div\");\r\n    endContent.value.classList.add(\"endOfContent\");\r\n    _textLayer.value.appendChild(endContent.value);\r\n  }\r\n};\r\n\r\nconst onMouseDown = () => {\r\n  endContent.value?.classList.add(\"active\");\r\n};\r\n\r\nconst onMouseUp = () => {\r\n  endContent.value?.classList.remove(\"active\");\r\n};\r\n\r\nonMounted(() => {\r\n  nextTick(() => {\r\n    renderTextContent();\r\n  });\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  layer.value?.cancel();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.textLayer {\r\n  span,\r\n  br {\r\n    min-height: 100%;\r\n    min-width: 100%;\r\n  }\r\n}\r\n.textLayer ::-moz-selection {\r\n  background: rgba(33 133 255 / 0.25);\r\n  background: color-mix(in srgb, AccentColor, transparent 75%);\r\n}\r\n\r\n.textLayer ::selection {\r\n  background: rgba(33 133 255 / 0.25);\r\n  background: color-mix(in srgb, AccentColor, transparent 75%);\r\n}\r\n\r\n.endOfContent {\r\n  content: \" \";\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div\r\n    ref=\"_textLayer\"\r\n    class=\"textLayer\"\r\n    @mousedown=\"onMouseDown\"\r\n    @mouseup=\"onMouseUp\"\r\n  />\r\n</template>\r\n"],"names":["props","__props","_textLayer","ref","layer","shallowRef","endContent","renderTextContent","viewport","rotation","scale","textContent","TextLayer","rat","e","onMouseDown","_a","onMouseUp","onMounted","nextTick","onBeforeUnmount"],"mappings":";;;;;;;;;AAKA,UAAMA,IAAQC,GAKRC,IAAaC,EAAiB,GAC9BC,IAAQC,EAAsB,GAC9BC,IAAaH,EAAiB,GAE9BI,IAAoB,YAAY;AAChC,UAAEL,EAAW,OAAO;AACtB,QAAIE,EAAM,SACRA,EAAM,MAAM,OAAO;AAEf,cAAA,EAAE,UAAAI,MAAaR,EAAM,UACrB,EAAE,UAAAS,GAAU,OAAAC,EAAA,IAAUF,GACtBG,IAAc,MAAMX,EAAM,KAAK,kBAAkB;AAAA,UACrD,sBAAsB;AAAA,UACtB,sBAAsB;AAAA,QAAA,CACvB;AACK,QAAAI,EAAA,QAAQ,IAAIQ,EAAU;AAAA,UAC1B,mBAAmBD;AAAA,UACnB,WAAWT,EAAW;AAAA,UACtB,UAAAM;AAAA,QAAA,CACD;AACG,YAAAK,IAAML,EAAS,QAAQA,EAAS,QAChC,IAAI;AAER,QAAI,KAAK,IAAIC,CAAQ,KAAK,OACnB,KAAA,cAAc,MAAMI,CAAG,OAG1B,KAAK,IAAIJ,CAAQ,KAAK,QACnB,KAAA,0BAGH,KAAK,IAAIA,CAAQ,KAAK,QACnB,KAAA,cAAc,MAAMI,CAAG,OAG9B,KAAK,UAAUJ,CAAQ;AACnB,YAAA,IAAyBP,EAAW,MAAM;AAC9C,UAAE,YAAY,kBAAkB,GAAGQ,CAAK,EAAE,GAC1C;AAAA,UACE;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QAAA,EACA,QAAQ,CAACI,MAAM;AACX,UAAA,EAAE,eAAeA,CAAC,KACpB,OAAO,OAAO,GAAG,EAAE,CAACA,CAAC,GAAG,GAAG;AAAA,QAC7B,CACD,GACK,MAAAV,EAAM,MAAM,OAAO,GAEdE,EAAA,QAAQ,SAAS,cAAc,KAAK,GACpCA,EAAA,MAAM,UAAU,IAAI,cAAc,GAClCJ,EAAA,MAAM,YAAYI,EAAW,KAAK;AAAA,MAAA;AAAA,IAEjD,GAEMS,IAAc,MAAM;;AACb,OAAAC,IAAAV,EAAA,UAAA,QAAAU,EAAO,UAAU,IAAI;AAAA,IAClC,GAEMC,IAAY,MAAM;;AACX,OAAAD,IAAAV,EAAA,UAAA,QAAAU,EAAO,UAAU,OAAO;AAAA,IACrC;AAEA,WAAAE,EAAU,MAAM;AACd,MAAAC,EAAS,MAAM;AACK,QAAAZ,EAAA;AAAA,MAAA,CACnB;AAAA,IAAA,CACF,GAEDa,EAAgB,MAAM;;AACpB,OAAAJ,IAAAZ,EAAM,UAAN,QAAAY,EAAa;AAAA,IAAO,CACrB;;;;;;;;;"}