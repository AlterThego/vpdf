{"version":3,"file":"DeoI69LV.js","sources":["../src/components/vPdf.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { defineAsyncComponent, ref, computed, toRef, watch } from \"vue\";\r\nimport { pdfSource, Point } from \"../types/pdf\";\r\nimport { usePdf } from \"../composables/usePdf\";\r\nimport type { OnProgressParameters } from \"pdfjs-dist/types/src/display/api\";\r\n\r\nconst PDFViewer = defineAsyncComponent(() => import(\"./vPdfViewer.vue\"));\r\nconst PDFMenu = defineAsyncComponent(() => import(\"./menu/index.vue\"));\r\nconst PDFDialog = defineAsyncComponent(() => import(\"./dialog/index.vue\"));\r\nconst PDFPassword = defineAsyncComponent(() => import(\"./password/index.vue\"));\r\nconst PDFSideBar = defineAsyncComponent(() => import(\"./sidebar/index.vue\"));\r\nconst Progress = defineAsyncComponent(() => import(\"./progress/index.vue\"));\r\n\r\ntype IProps = {\r\n  src: pdfSource;\r\n  workerSrc?: string;\r\n  smoothJump?: boolean;\r\n  textLayer?: boolean;\r\n  password?: string;\r\n  onPassword?: (callback: Function, reason: number) => {};\r\n};\r\n\r\ntype IViewerOptions = {\r\n  mode: \"vertical\" | \"horizontal\";\r\n  scale: number;\r\n  sidebar: boolean;\r\n  rotation: number;\r\n};\r\n\r\ntype IDialog = {\r\n  show: boolean;\r\n  data: any;\r\n  type: string;\r\n  persistent: boolean;\r\n};\r\n\r\nconst props = withDefaults(defineProps<IProps>(), {\r\n  smoothJump: false,\r\n  textLayer: false,\r\n});\r\n\r\nconst viewer = ref<typeof PDFViewer>();\r\nconst menu = ref<typeof PDFMenu>();\r\nconst error = ref();\r\nconst progress = ref({\r\n  loader: 0,\r\n  viewer: 0,\r\n});\r\nconst viewerOptions = ref<IViewerOptions>({\r\n  mode: \"vertical\",\r\n  scale: 1.75,\r\n  sidebar: false,\r\n  rotation: 0,\r\n});\r\n\r\nconst dialog = ref<IDialog>({\r\n  show: false,\r\n  data: undefined,\r\n  type: \"\",\r\n  persistent: false,\r\n});\r\n\r\nconst openDialog = (data: any, type: string, persistent: boolean = false) => {\r\n  dialog.value.data = data;\r\n  dialog.value.persistent = persistent;\r\n  dialog.value.type = type;\r\n  dialog.value.show = true;\r\n};\r\n\r\nconst { pdf, pages, loading, outline, attachments } = usePdf(\r\n  toRef(() => props.src),\r\n  {\r\n    workerSrc: props.workerSrc,\r\n    password: props.password,\r\n    onPassword: (callback, reason) => {\r\n      if (!!props.onPassword && typeof props.onPassword === \"function\") {\r\n        typeof props.onPassword(callback, reason);\r\n      } else if (reason >= 1) {\r\n        openDialog(\r\n          {\r\n            reason,\r\n            cb: (pass: string) => {\r\n              callback(pass);\r\n              dialog.value.show = false;\r\n            },\r\n          },\r\n          \"passwordPrompt\",\r\n          true\r\n        );\r\n      }\r\n    },\r\n    onProgress: (e: OnProgressParameters) => {\r\n      progress.value.loader = (e.loaded / e.total) * 85;\r\n    },\r\n    onError: (e) => {\r\n      error.value = e;\r\n    },\r\n  }\r\n);\r\n\r\nconst sidebarOptions = computed(() => ({\r\n  thumbnails: true,\r\n  bookmarks: true,\r\n  attachments: true,\r\n}));\r\n\r\nconst onViewerProgress = (e: OnProgressParameters) => {\r\n  progress.value.viewer = (e.loaded / e.total) * 15;\r\n};\r\n\r\nconst changePage = (page: number, offset: Point | null = null) => {\r\n  viewer.value?.changePage(page, offset);\r\n};\r\n\r\nconst fitPage = (mode: \"fit\" | \"width\" | \"height\" = \"fit\") => {\r\n  viewerOptions.value.scale = viewer.value?.fitPage(mode);\r\n};\r\n\r\nconst onMouseWheel = (e: any) => {\r\n  if (e.ctrlKey) {\r\n    e.preventDefault();\r\n    const scales = menu.value?.scales;\r\n    let scaleIndex = scales.findIndex(\r\n      (s: any) => s.value == viewerOptions.value.scale\r\n    );\r\n    if (e.wheelDeltaY > 0) {\r\n      scaleIndex =\r\n        scaleIndex > -1\r\n          ? scaleIndex\r\n          : scales.findIndex((s: any) => s.value >= viewerOptions.value.scale) -\r\n            1;\r\n      scaleIndex = Math.min(\r\n        scaleIndex + 1,\r\n        scales.filter((s: any) => !!s.value).length - 1\r\n      );\r\n    } else {\r\n      scaleIndex =\r\n        scaleIndex > -1\r\n          ? scaleIndex\r\n          : scales.findLastIndex(\r\n              (s: any) => s.value <= viewerOptions.value.scale\r\n            ) + 1;\r\n      scaleIndex = Math.max(scaleIndex - 1, 0);\r\n    }\r\n    viewerOptions.value.scale = scales[scaleIndex].value;\r\n  }\r\n};\r\n\r\nwatch(\r\n  () => props.src,\r\n  () => {\r\n    progress.value = {\r\n      loader: 0,\r\n      viewer: 0,\r\n    };\r\n    dialog.value.show = false;\r\n    error.value = undefined;\r\n  }\r\n);\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"relative flex h-full flex-col border border-gray-400/25 bg-background text-foreground\"\r\n  >\r\n    <PDFMenu\r\n      ref=\"menu\"\r\n      :pages=\"pages\"\r\n      :page=\"viewer?.currentPage ?? 1\"\r\n      :loading=\"loading\"\r\n      v-model:mode=\"viewerOptions.mode\"\r\n      v-model:scale=\"viewerOptions.scale\"\r\n      v-model:sidebar=\"viewerOptions.sidebar\"\r\n      v-model:rotation=\"viewerOptions.rotation\"\r\n      @fitPage=\"fitPage\"\r\n      @update:page=\"changePage\"\r\n    >\r\n      <template #prepend>\r\n        <div class=\"absolute inset-x-0 bottom-0\">\r\n          <Progress\r\n            v-if=\"progress.loader + progress.viewer < 100\"\r\n            :value=\"+(progress.loader + progress.viewer).toFixed(2)\"\r\n            class=\"h-0.5 w-full\"\r\n          />\r\n        </div>\r\n        <div\r\n          v-if=\"!!error\"\r\n          class=\"absolute top-full z-20 w-full bg-negative px-2 py-1 text-sm font-semibold leading-none text-rose-50\"\r\n        >\r\n          {{ error.message }}\r\n        </div>\r\n      </template>\r\n    </PDFMenu>\r\n    <div class=\"relative flex min-h-0 min-w-0 flex-auto\">\r\n      <PDFSideBar\r\n        v-if=\"!error\"\r\n        v-model=\"viewerOptions.sidebar\"\r\n        :pdf=\"pdf\"\r\n        :options=\"sidebarOptions\"\r\n        :outline=\"outline\"\r\n        :attachments=\"attachments\"\r\n        :page=\"viewer?.currentPage ?? 1\"\r\n        :rotation=\"viewerOptions.rotation\"\r\n        @changePage=\"(e) => changePage(e.page, e.offset)\"\r\n      />\r\n      <PDFViewer\r\n        v-if=\"!!pdf && !loading && !error\"\r\n        ref=\"viewer\"\r\n        :pdf=\"pdf\"\r\n        :smoothJump=\"smoothJump\"\r\n        :view=\"viewerOptions.mode\"\r\n        :textLayer=\"textLayer\"\r\n        :rotation=\"viewerOptions.rotation\"\r\n        @progress=\"onViewerProgress\"\r\n        v-model:scale=\"viewerOptions.scale\"\r\n        class=\"max-h-full min-h-0 min-w-0 flex-auto transition-all\"\r\n        :class=\"{\r\n          'md:ml-64': viewerOptions.sidebar && !error,\r\n        }\"\r\n        @wheel=\"onMouseWheel\"\r\n        @mousewheel=\"onMouseWheel\"\r\n      />\r\n    </div>\r\n    <PDFDialog\r\n      v-model=\"dialog.show\"\r\n      :persistent=\"dialog.persistent\"\r\n      v-slot=\"{ close }\"\r\n      class=\"z-20\"\r\n    >\r\n      <PDFPassword\r\n        :callback=\"dialog.data.cb\"\r\n        :reason=\"dialog.data.reason\"\r\n        class=\"\"\r\n      />\r\n    </PDFDialog>\r\n  </div>\r\n</template>\r\n"],"names":["PDFViewer","defineAsyncComponent","PDFMenu","PDFDialog","PDFPassword","PDFSideBar","Progress","props","__props","viewer","ref","menu","error","progress","viewerOptions","dialog","openDialog","data","type","persistent","pdf","pages","loading","outline","attachments","usePdf","toRef","callback","reason","pass","e","sidebarOptions","computed","onViewerProgress","changePage","page","offset","_a","fitPage","mode","onMouseWheel","scales","scaleIndex","s","watch"],"mappings":"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"}